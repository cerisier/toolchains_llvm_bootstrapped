--- a/libc/intrin/memchr.c
+++ b/libc/intrin/memchr.c
@@ -20,7 +20,18 @@
 #include "libc/nexgen32e/x86feature.h"
 #include "libc/str/str.h"
 #include "third_party/aarch64/arm_neon.internal.h"
-#include "third_party/intel/emmintrin.internal.h"
+#if defined(__has_builtin)
+#define COSMO_HAS_MMX_BUILTINS __has_builtin(__builtin_ia32_vec_init_v2si)
+#else
+#define COSMO_HAS_MMX_BUILTINS 0
+#endif
+
+#if defined(__x86_64__) && !defined(__chibicc__) && COSMO_HAS_MMX_BUILTINS
+#include "third_party/intel/emmintrin.internal.h"
+#define COSMO_MEMCHR_SSE 1
+#else
+#define COSMO_MEMCHR_SSE 0
+#endif
 #ifndef __aarch64__
 
 static inline const unsigned char *memchr_pure(const unsigned char *s,
@@ -34,7 +45,7 @@ static inline const unsigned char *memchr_pure(const unsigned char *s,
   return 0;
 }
 
-#if defined(__x86_64__) && !defined(__chibicc__)
+#if COSMO_MEMCHR_SSE
 static const char *memchr_sse(const char *s, char c, size_t n) {
   const char *e = s + n;
   __m128i t = _mm_set1_epi8(c);
@@ -72,7 +83,7 @@ void *memchr(const void *s, int c, size_t n) {
  * @asyncsignalsafe
  */
 void *memchr(const void *s, int c, size_t n) {
-#if defined(__x86_64__) && !defined(__chibicc__)
+#if COSMO_MEMCHR_SSE
   return (void *)memchr_sse(s, c, n);
 #else
   return (void *)memchr_pure(s, c, n);
